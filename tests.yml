config:
  interpreter: /bin/sh
  timeout: 1m
  workdir: .
tests:
  - name: Compiles
    checks:
      - exitcode
    commands:
      - go build -o ./testbeds/platform -v .
  - name: Discover
    checks:
      - stderr
    tests:
      - name: Go Basic
        commands:
          - go run . discover ./testbeds/gobasic
      - name: Go Workspace
        commands:
          - go run . discover ./testbeds/gowork
      - name: PNPM Basic
        commands:
          - go run . discover ./testbeds/pnpmbasic
      - name: PNPM Workspace
        commands:
          - go run . discover ./testbeds/pnpmwork
  - name: Bootstrap
    checks:
      - exitcode
      - stderr
    tests:
      - name: Go Basic
        checks:
          - ./testbeds/gobasic/platform.toml
          - ./testbeds/gobasic/platform
          - ./testbeds/gobasic/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/gobasic "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
      - name: Go Workspace
        checks:
          - ./testbeds/gowork/platform.toml
          - ./testbeds/gowork/platform
          - ./testbeds/gowork/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/gowork "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
      - name: PNPM Basic
        checks:
          - ./testbeds/pnpmbasic/platform.toml
          - ./testbeds/pnpmbasic/platform
          - ./testbeds/pnpmbasic/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/pnpmbasic "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
      - name: PNPM Workspace
        checks:
          - ./testbeds/pnpmwork/platform.toml
          - ./testbeds/pnpmwork/platform
          - ./testbeds/pnpmwork/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/pnpmbasic "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
  # - name: Build
  #   checks:
  #     - stderr
  #     - exitcode
  #   tests:
  #     - name: Go Basic
  #       config:
  #         workdir: ./testbeds/gobasic
  #       commands:
  #         - ../platform -q build
