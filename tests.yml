name: Platform
config:
  interpreter: /bin/sh
  timeout: 1m
  workdir: .
tests:
  - name: Platform
    checks:
      - exitcode
    commands:
      - go build -o ./testbeds/platform -v .
  - name: Go Basic
    tests:
      - name: Discover
        checks:
          - stdout
        commands:
          - ./testbed.sh gobasic discover 2>&1 | sort
      - name: Bootstrap
        checks:
          - ./testbeds/gobasic/platform.toml
          - ./testbeds/gobasic/platform
          - ./testbeds/gobasic/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/gobasic "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
  - name: Go Workspace
    tests:
      - name: Discover
        checks:
          - stdout
        commands:
          - ./testbed.sh gowork discover 2>&1 | sort
      - name: Bootstrap
        checks:
          - ./testbeds/gowork/platform.toml
          - ./testbeds/gowork/platform
          - ./testbeds/gowork/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/gowork "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
  - name: PNPM Basic
    tests:
      - name: Discover
        checks:
          - stdout
        commands:
          - ./testbed.sh pnpmbasic discover 2>&1 | sort
      - name: Bootstrap
        checks:
          - ./testbeds/pnpmbasic/platform.toml
          - ./testbeds/pnpmbasic/platform
          - ./testbeds/pnpmbasic/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/pnpmbasic "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
  - name: PNPM Workspace
    tests:
      - name: Discover
        checks:
          - stdout
        commands:
          - ./testbed.sh pnpmwork discover 2>&1 | sort
      - name: Bootstrap
        checks:
          - ./testbeds/pnpmwork/platform.toml
          - ./testbeds/pnpmwork/platform
          - ./testbeds/pnpmwork/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/pnpmwork "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
