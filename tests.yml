config:
  interpreter: /bin/sh
  timeout: 5s
  workdir: .
tests:
  - name: Compiles
    checks:
      - exitcode
    commands:
      - go install -v .
  - name: Discover
    checks:
      - exitcode
      - stdout
    tests:
      - name: Go Basic
        commands:
          - go run . -q discover ./testbeds/gobasic   2>&1 | grep "discovered" | sort
      - name: Go Workspace
        commands:
          - go run . -q discover ./testbeds/gowork    2>&1 | grep "discovered" | sort
      - name: PNPM Basic
        commands:
          - go run . -q discover ./testbeds/pnpmbasic 2>&1 | grep "discovered" | sort
      - name: PNPM Workspace
        commands:
          - go run . -q discover ./testbeds/pnpmwork 2>&1 | grep "discovered" | sort
  - name: Bootstrap
    checks:
      - exitcode
      - stderr
    tests:
      - name: Go Basic
        checks:
          - ./testbeds/gobasic/platform.toml
          - ./testbeds/gobasic/platform
          - ./testbeds/gobasic/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/gobasic "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
      - name: Go Workspace
        checks:
          - ./testbeds/gowork/platform.toml
          - ./testbeds/gowork/platform
          - ./testbeds/gowork/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/gowork "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
      - name: PNPM Basic
        checks:
          - ./testbeds/pnpmbasic/platform.toml
          - ./testbeds/pnpmbasic/platform
          - ./testbeds/pnpmbasic/.buildkite/*.*
        commands:
          - go run . -q bootstrap ./testbeds/pnpmbasic "Johnny Appleseed" "john@apple.com" "github.com/prod9/platform" "ghcr.io/prod9/platform"
